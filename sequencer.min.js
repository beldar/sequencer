!function(window,document){"use strict";var Sequencer=function(a){return this.options=a||{},this.fps=this.options.fps||50,this.canvas=this.options.canvas||document.getElementById("canvas"),this.x=this.options.x||0,this.y=this.options.y||0,this.width=this.options.width||!1,this.height=this.options.height||!1,this.data={},this.ctx=this.canvas.getContext("2d"),this.playing=!1,this.current=0,this.total=0,this.loops=1,this.image=new Image,this.reversed=!1,window.raf=window.requestAnimationFrame,window.caf=window.cancelAnimationFrame,this};Sequencer.prototype.constructor=Sequencer,Sequencer.prototype.loadSequence=function(name,sequence){var that=this;return sequence=sequence||this.sequence,name=name||"default",this.get(sequence,function(data){that.data[name]=eval(data);var event=new CustomEvent("loaded",{detail:{sequence:name}});that.canvas.dispatchEvent(event)}),this},Sequencer.prototype.play=function(a,b){var c=this;return"undefined"==typeof this.data[a]?!1:(this.loop=b,this.total=this.data[a].length,this.current=0,this.loops=0,this.currentSequence=a||"default",this.playing=!0,this.time=(new Date).getTime(),this.af=window.raf(function(){c.draw()}),this)},Sequencer.prototype.reverse=function(a,b){return"undefined"==typeof this.data[a]?!1:(this.data[a].reverse(),this.reversed=!0,this.play(a,b))},Sequencer.prototype.dereverse=function(){return this.reversed&&(this.data[this.currentSequence].reverse(),this.reversed=!1),this},Sequencer.prototype.get=function(a,b){try{var c=new(window.XMLHttpRequest||window.ActiveXObject)("MSXML2.XMLHTTP.3.0");c.open("GET",a,!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){return c.readyState>3&&b&&b(c.responseText,c)},c.send(null)}catch(d){return window.console&&console.log("Ajax request failed",d)}},Sequencer.prototype.stop=function(){return window.caf(this.af),this.playing=!1,this.data=[],this},Sequencer.prototype.clean=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},Sequencer.prototype.draw=function(){if(!this.playing)return!1;var a,b=(new Date).getTime(),c=b-this.time,d=this;return this.af=window.raf(function(){d.draw()}),c<this.fps?!1:(this.time=b,this.current===this.total&&this.loop?(this.current=0,this.loops++,a=new CustomEvent("stopped",{detail:{sequence:this.currentSequence,loops:this.loops}}),this.canvas.dispatchEvent(a),!1):this.current!==this.total||this.loop?(this.image.onload=function(){d.clean(),d.width&&d.height?d.ctx.drawImage(d.image,d.x,d.y,d.width,d.height):d.ctx.drawImage(d.image,d.x,d.y)},this.image.onerror=function(a){console.error("Image failed to load",a)},this.image.src=this.data[this.currentSequence][this.current],this.image.complete&&this.image.onload(),void this.current++):(window.caf(this.af),this.playing=!1,this.current=0,a=new CustomEvent("stopped",{detail:{sequence:this.currentSequence,loops:this.loops,reversed:this.reversed}}),this.canvas.dispatchEvent(a),!1))},function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),window.Sequencer=Sequencer}(window,document);